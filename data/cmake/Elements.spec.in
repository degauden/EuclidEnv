# -*- rpm-spec -*-
Summary:        Euclid @CPACK_PACKAGE_NAME@ Project
Name:           @CPACK_PACKAGE_NAME@
Version:        @CPACK_PACKAGE_VERSION@
Release:        @CPACK_PACKAGE_RELEASE@%{?dist}
License:        Public Domain
Group:          Development/Tools
Source:         @CPACK_PACKAGE_NAME@-@CPACK_PACKAGE_VERSION@.tar.gz
Vendor:         @CPACK_PACKAGE_VENDOR@


BuildRoot: %{_tmppath}/%{name}-root

BuildRequires: gcc > 4.7, cmake >= 2.6

Requires(post):    /sbin/ldconfig
Requires(postun):  /sbin/ldconfig

%define bin_tag @CPACK_SYSTEM_NAME@
%define _prefix @EUCLID_BASE_DIR@/%{name}/%{version}/InstallArea/%{bin_tag}
%define libdir %{_prefix}/lib
%define pydir %{_prefix}/python
%define scriptsdir %{_prefix}/scripts
%define cmakedir %{_prefix}/cmake
%define confdir %{_prefix}/conf
%define auxdir %{_prefix}/aux

%define debug_package %{nil}

%description
@CPACK_RPM_PACKAGE_DESCRIPTION@

%package devel
Group:  Development/Libraries
Summary: The development part of the %{name} package
Requires: %{name} = %{version}-%{release}, cmake >= 2.6

%description devel
The development part of the %{name} package.

%package debuginfo
Summary: Debug information for package %{name}

%description debuginfo
Debug information for package %{name}

%prep
%setup -q

%build
export BINARY_TAG=%{bin_tag}
export VERBOSE=1
if [[ -z "$EUCLID_BASE" ]]; then
  export CMAKE_PROJECT_PATH=/opt/euclid
else
  export CMAKE_PROJECT_PATH=$EUCLID_BASE
fi
export CMAKE_PREFIX_PATH=$PWD/cmake:/usr/share/EuclidEnv/cmake
%__mkdir -p build.${BINARY_TAG}
cd build.${BINARY_TAG}
%cmake ../
%__make VERBOSE=1 %{?_smp_mflags} all

%install
export BINARY_TAG=%{bin_tag}
export VERBOSE=1
if [[ -z "$EUCLID_BASE" ]]; then
  export CMAKE_PROJECT_PATH=/opt/euclid
else
  export CMAKE_PROJECT_PATH=$EUCLID_BASE
fi
export CMAKE_PREFIX_PATH=$PWD/cmake:/usr/share/EuclidEnv/cmake
cd build.${BINARY_TAG}
%__make install VERBOSE=1 DESTDIR=$RPM_BUILD_ROOT

%clean
%__rm -rf $RPM_BUILD_ROOT

%post -p /sbin/ldconfig

%postun -p /sbin/ldconfig

@CPACK_RPM_REGULAR_FILES@

@CPACK_RPM_DEVEL_FILES@

@CPACK_RPM_DEBINFO_FILES@
